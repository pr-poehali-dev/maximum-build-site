# Руководство по созданию статической сборки для Open Server

## Обзор проекта

Проект представляет собой React-приложение (Vite + React + TypeScript + Tailwind CSS) с множественными страницами и маршрутизацией.

### Структура маршрутов:
- `/` - Главная страница (Home)
- `/about` - О компании
- `/services` - Услуги (с динамическими категориями)
- `/projects` или `/portfolio` - Портфолио проектов
- `/stock` - Акции
- `/calculator` - Калькулятор
- `/team` - Команда
- `/certificates` - Сертификаты
- `/contacts` - Контакты

## Способ 1: Стандартная сборка (Рекомендуется)

### Шаг 1: Установка зависимостей
```bash
npm install
# или
bun install
```

### Шаг 2: Создание production сборки
```bash
npm run build
# или
bun run build
```

Эта команда создаст папку `dist` с оптимизированными статическими файлами.

### Шаг 3: Структура сборки
После выполнения команды `build` будет создана следующая структура:
```
dist/
├── index.html
├── assets/
│   ├── index-[hash].js
│   └── index-[hash].css
├── favicon.svg
├── placeholder.svg
├── robots.txt
├── .htaccess (файл для настройки сервера)
└── 4x/ (папка с изображениями)
```

### Шаг 4: Установка на Open Server

1. Скопируйте все содержимое папки `dist` в корневую директорию вашего сайта на Open Server (например, в `domains/your-site/`)

2. Убедитесь, что файл `.htaccess` находится в корневой папке сайта

3. В настройках Open Server:
   - Откройте настройки домена
   - Убедитесь, что включен модуль `mod_rewrite` для Apache
   - Если используете Nginx, см. конфигурацию ниже

## Способ 2: Конфигурация для Nginx (Open Server)

Если Open Server использует Nginx, создайте файл конфигурации:

```nginx
server {
    listen 80;
    server_name your-domain.local;
    root /path/to/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # Кэширование статических ресурсов
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # GZIP сжатие
    gzip on;
    gzip_vary on;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/json;
}
```

## Способ 3: Локальный предварительный просмотр

Для проверки сборки перед развертыванием:

```bash
npm run preview
# или
bun run preview
```

Это запустит локальный сервер с production сборкой на `http://localhost:4173`

## Важные замечания

### 1. Проблема с BrowserRouter
Проект использует `BrowserRouter` из React Router, который требует серверной настройки для корректной работы с прямыми ссылками. Файл `.htaccess` решает эту проблему для Apache, перенаправляя все запросы на `index.html`.

### 2. Внешние зависимости
Проект использует внешние скрипты:
- `https://cdn.poehali.dev/intertnal/js/pp-min-2.js`
- `https://cdn.poehali.dev/intertnal/js/route-min.js`
- `https://cdn.poehali.dev/intertnal/js/telemetry-min.js`
- `https://cdn.poehali.dev/intertnal/js/inspector-min.js`
- Yandex.Metrika для аналитики

Убедитесь, что есть доступ к интернету для загрузки этих скриптов.

### 3. Базовый путь
Если сайт будет размещен не в корне домена (например, `your-domain.com/subfolder/`), необходимо:

1. Изменить строку `base: './'` в `vite.config.ts` на `base: '/subfolder/'`
2. Пересобрать проект
3. Обновить `.htaccess` соответствующим образом

### 4. Оптимизация размера сборки
Текущая конфигурация создает оптимизированную сборку с:
- Минификацией JavaScript и CSS
- Tree-shaking для удаления неиспользуемого кода
- Сжатием изображений
- Code splitting для асинхронной загрузки компонентов

## Проверочный список перед развертыванием

- [ ] Установлены все зависимости (`npm install`)
- [ ] Выполнена команда `npm run build`
- [ ] Папка `dist` успешно создана
- [ ] Файл `.htaccess` находится в папке `dist`
- [ ] Все файлы скопированы на сервер
- [ ] Настроен mod_rewrite (для Apache) или try_files (для Nginx)
- [ ] Проверена работа всех маршрутов
- [ ] Проверена загрузка статических ресурсов (изображения, CSS, JS)

## Устранение неполадок

### Проблема: Белая страница после загрузки
**Решение:** Проверьте консоль браузера на наличие ошибок. Обычно это проблема с путями к файлам.

### Проблема: 404 при переходе по прямым ссылкам
**Решение:** Убедитесь, что `.htaccess` работает и mod_rewrite включен.

### Проблема: Стили не загружаются
**Решение:** Проверьте, что файлы CSS находятся в папке `assets` и доступны по сети.

### Проблема: Изображения не отображаются
**Решение:** Убедитесь, что папки `4x` и файлы `favicon.svg`, `placeholder.svg` скопированы на сервер.

## Дополнительные команды

```bash
# Сборка в режиме разработки (с source maps)
npm run build:dev

# Проверка кода
npm run lint

# Запуск dev-сервера
npm run dev
```

## Контакты и поддержка

Если возникли проблемы с развертыванием, проверьте:
1. Логи сервера Open Server
2. Консоль браузера (F12 -> Console)
3. Вкладку Network в DevTools для проверки загрузки ресурсов

---

**Дата создания:** 18 января 2026
**Версия:** 1.0
